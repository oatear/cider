<p-toast></p-toast>
<p-dialog [(visible)]="visible" (visibleChange)="visibleChange.emit($event)" (onHide)="hideDialog()"
  [style]="{width: '450px'}" [header]="title || ('controls.create-edit' | translate)" [modal]="true"
  styleClass="p-fluid">
  <ng-template pTemplate="content">
    @for (col of columns; track col) {
      @switch (true) {
        @case (col.hidden) {
        }
        @case (!col.hidden && col.service !== undefined) {
          @if (col.service) {
            <div class="p-field">
              <label [for]="col.field">{{col.header}}</label>
              <p-select [options]="(col.service | entityList | async) || []" [(ngModel)]="entity[col.field]"
                [id]="col.field | toString" optionLabel="name" [optionValue]="col.service.getIdField()"
              class="p-mr-2" appendTo="body"></p-select>
            </div>
          }
        }
        @case (!col.hidden && col.type === FieldType.option
          && col.service === undefined) {
          <div class="p-field">
            <label [for]="col.field">{{col.header}}</label>
            <p-select [options]="col.options || []" [(ngModel)]="entity[col.field]"
            [id]="col.field | toString" class="p-mr-2" appendTo="body"></p-select>
          </div>
        }
        @case (!col.hidden && col.type === FieldType.optionList
          && (!$any(entity).type || $any(entity).type !== FieldType.option)) {
        }
        @case (!col.hidden && col.type === FieldType.optionList
          && $any(entity).type && $any(entity).type === FieldType.option) {
          <div class="p-field">
            <label [for]="col.field">{{col.header}}</label>
            <p-message severity="info">Press [Enter] to create new options</p-message>
            <p-autocomplete [(ngModel)]="entity[col.field]" [inputId]="col.field.toString()"
            [typeahead]="false" multiple fluid></p-autocomplete>
          </div>
        }
        @case (!col.hidden && col.type === FieldType.file) {
          <div class="p-field">
            <label [for]="col.field">{{col.header}}</label>
            <p-fileUpload name="entity[col.field]" mode="basic" accept="image/*,font/*"
              [maxFileSize]="200000000" [chooseLabel]="'controls.import' | translate" class="inline-block"
            [customUpload]="true" (onSelect)="uploadFile(entity, col.field, $event)"></p-fileUpload>
          </div>
        }
        @case (!col.hidden && col.type === FieldType.textArea) {
          <div class="p-field">
            <label [for]="col.field">{{col.header}}</label>
            <textarea [rows]="5" [cols]="30" pTextarea [autoResize]="true" [id]="col.field"
            [(ngModel)]="entity[col.field]"></textarea>
          </div>
        }
        @default {
          <div class="p-field">
            <label [for]="col.field">{{col.header}}</label>
            <input type="text" pInputText [id]="col.field" [(ngModel)]="entity[col.field]" required
              autofocus />
          </div>
        }
      }
    }
  </ng-template>
  <ng-template pTemplate="footer">
    <button pButton pRipple [label]="'controls.cancel' | translate" icon="pi pi-times" class="p-button-text"
    (click)="hideDialog()"></button>
    <button pButton pRipple [label]="'controls.save' | translate" icon="pi pi-check" class="p-button-text"
    (click)="save()"></button>
  </ng-template>
</p-dialog>